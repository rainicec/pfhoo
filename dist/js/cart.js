"use strict";require(["config"],function(){require(["jquery","head","common"],function(){$("#side").load("sidebar",function(){require(["sidebar"],function(){$("#side").on("click",".cart",function(){location.href="cart.html"})})}),$("#bottom_lam").load("bottom_con",function(){require(["bottom_con"])}),$("#foot").load("foot",function(){}),getCookie("user")?($("#topnav .username").html(getCookie("user")),$("#topnav .loginout").html("退出"),$("#topnav .regsj").html("我的数据包"),$("#topnav .mesg").html("我的私信"),$("#topnav").on("click",".loginout",function(){removeCookie("user"),location.href="../index.html"})):($("#topnav").on("click",".loginout",function(){location.href="login.html"}),$("#topnav").on("click",".regsj",function(){location.href="register.html"}));var c=!0;($("#hide").click(function(){c=(c?($("#autinf").css("display","block"),$(this).attr("src","../css/img/trusted-web3_01.png")):($("#autinf").css("display","none"),$(this).attr("src","../css/img/trusted-web4_01.png")),!c)}),setTimeout(function(){$("#autinf").css("display","none"),$("#hide").attr("src","../css/img/trusted-web4_01.png")},3e3),getCookie("user"))?new Promise(function(n){$.ajax({type:"get",url:"../api/cart.php",data:"user="+getCookie("user"),success:function(c){n(c)}})}).then(function(c){if("nothing"==c)$("#gbox").html('<img src="../css/img/emptycart.jpg" alt="" class="emptycart">');else{var n=function(c){var n=c.parent().parent().find(".onepri").text().slice(1);c.parent().parent().find(".allpri").text("￥"+o*n)},t=function(){var e=0,t=0,i=0;$("#gbox .check_box").each(function(c,n){$(n).find(".check").is(":checked")&&(e++,t+=1*$(n).parent().next().find(".num").val(),i+=1*$(n).parent().next().find(".allpri").text().slice(1))}),$(".add .ssbox span:eq(0)").text(e),$(".add .ssbox span:eq(1)").text(t),$(".add .alltar").text("￥"+i)},e=JSON.parse(c),i="";for(var a in e){var s=e[a][0].imgpath.split("&");i+='<div  data-id="'+e[a].id+'">\n                            <div class="goodsname clearfix">\n                                <div class="check_box">\n                                    <input type="checkbox" class="check">\n                                    <span>'+e[a][0].name+'</span>\n                                    <span class="check_img"></span>\n                                </div>\n                                \n                            </div>\n                            <table class="goodsmain">\n                                <tr>\n                                    <td>\n                                        <img src="'+s[0]+'" alt="">\n                                        <span>戒指大小 17</span>\n                                    </td>\n                                    <td>\n                                        <span class="reduce"></span>\n                                        <input type="text" class="num" value="'+e[a].num+'">\n                                        <span class="plus"></span>\n                                    </td>\n                                    <td class="stock">'+e[a][0].stock+'</td>\n                                    <td class="onepri">￥'+e[a][0].price+'</td>\n                                    <td>≥1&nbsp;&nbsp;&nbsp;13.00</td>\n                                    <td class="allpri">￥'+e[a][0].price*e[a].num+'</td>\n                                    <td>\n                                        <a href="###" class="delg">删除</a>\n                                    </td>\n                                </tr>\n                            </table>\n                            </div>'}$("#gbox").html(i),1*$("#main").innerHeight()+400>$(window).innerHeight()&&$("#main .add").css({position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)"}),$(window).scroll(function(){var c=$("#main").innerHeight()+$("#top_banner").innerHeight()+$("#topnav").innerHeight()+$("#header").innerHeight();$(window).scrollTop()>c-400?$("#main .add").css({position:"absolute",bottom:"20px",left:"0",transform:"translateX(0)"}):$(window).scrollTop()<c-$(window).innerHeight()&&$("#main .add").css({position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)"})});var o=0;$("#main").on("click",".reduce",function(){o=$(this).parent().find(".num").val(),--o<0&&(o=0),$(this).parent().find(".num").val(o),$.ajax({type:"get",url:"../api/incart.php",data:{gid:$(this).parent().parent().parent().parent().parent().attr("data-id"),user:getCookie("user"),num:o},success:function(c){}});var c=$(this);n(c),t()}),$("#main").on("click",".plus",function(){o=$(this).parent().find(".num").val(),++o>$(this).parent().parent().find(".stock").text()&&(o=$(this).parent().parent().find(".stock").text()),$(this).parent().find(".num").val(o),$.ajax({type:"get",url:"../api/incart.php",data:{gid:$(this).parent().parent().parent().parent().parent().attr("data-id"),user:getCookie("user"),num:o},success:function(c){}});var c=$(this);n(c),t()});var r=/^[0-9]*$/;$("#main").on("keyup",".num",function(){r.test($(this).val())&&(o=1*$(this).val()>$(this).parent().parent().find(".stock").text()?$(this).parent().parent().find(".stock").text():$(this).val()),$(this).val(o),$.ajax({type:"get",url:"../api/incart.php",data:{gid:$(this).parent().parent().parent().parent().parent().attr("data-id"),user:getCookie("user"),num:o},success:function(c){}});var c=$(this);n(c),t()}),$("#main").on("click",".delg",function(){var c=$(this).parent().parent().parent().parent().parent().attr("data-id"),n=$(this);confirm("确认要删除吗？")&&$.ajax({type:"get",url:"../api/delcart.php",data:"id="+c+"&user="+getCookie("user"),success:function(c){"yes"==c?(n.parent().parent().parent().parent().parent().remove(),t()):alert("删除失败，请稍后再试"),0==$("#gbox .check").length&&$("#gbox").html('<img src="../css/img/emptycart.jpg" alt="" class="emptycart">')}})}),$("#main").on("click",".alldel",function(){confirm("确认要删除选中的商品吗？")&&$("#gbox .check").each(function(){console.log($(this));var c=$(this).parent().parent().parent().attr("data-id"),n=$(this);$(this).is(":checked")&&$.ajax({type:"get",url:"../api/delcart.php",data:"id="+c+"&user="+getCookie("user"),success:function(c){"yes"==c?(n.parent().parent().parent().remove(),t()):alert("删除失败，请稍后再试"),0==$("#gbox .check").length&&$("#gbox").html('<img src="../css/img/emptycart.jpg" alt="" class="emptycart">')}})})}),$("#gbox").on("click",".check_box",function(){$(this).find(".check").is(":checked")?($(this).find(".check").prop("checked",!1),$(this).find(".check_img").css("background","#fff")):($(this).find(".check").prop("checked",!0),$(this).find(".check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px"));var e=0;$("#gbox .check_box").each(function(c,n){$(n).find(".check").is(":checked")&&e++}),e>=$("#gbox .check_box").length?($("#main .allcheck .check").prop("checked",!0),$("#main .allcheck .check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px"),$("#main .shopcheck .check").prop("checked",!0),$("#main .shopcheck .check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px")):($("#main .allcheck .check").prop("checked",!1),$("#main .allcheck .check_img").css("background","#fff"),$("#main .shopcheck .check").prop("checked",!0),$("#main .shopcheck .check_img").css("background","#fff")),t()}),$("#main").on("click",".shopcheck",function(){$(this).find(".check").is(":checked")?($(this).find(".check").prop("checked",!1),$(this).find(".check_img").css("background","#fff")):($(this).find(".check").prop("checked",!0),$(this).find(".check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px")),$(this).find(".check").is(":checked")?($("#gbox .check").prop("checked",!0),$("#gbox").find(".check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px"),$("#main .allcheck .check").prop("checked",!0),$("#main .allcheck .check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px")):($("#gbox .check").prop("checked",!1),$("#gbox").find(".check_img").css("background","#fff"),$("#main .allcheck .check").prop("checked",!1),$("#main .allcheck .check_img").css("background","#fff")),t()}),$("#main").on("click",".allcheck",function(){$(this).find(".check").is(":checked")?($(this).find(".check").prop("checked",!1),$(this).find(".check_img").css("background","#fff")):($(this).find(".check").prop("checked",!0),$(this).find(".check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px")),$(this).find(".check").is(":checked")?($("#main .check").prop("checked",!0),$("#main").find(".check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px")):($("#main .check").prop("checked",!1),$("#main").find(".check_img").css("background","#fff")),t()}),$("#main .allcheck").find(".check").prop("checked",!0),$("#main .allcheck").find(".check").is(":checked")?($("#main .check").prop("checked",!0),$("#main").find(".check_img").css("background","url(../css/img/commom-s50680dba8f.png) 0 -46px")):($("#main .check").prop("checked",!1),$("#main").find(".check_img").css("background","#fff")),t(),t()}}):$("#gbox").html('<img src="../css/img/emptycart.jpg" alt="" class="emptycart">')})});